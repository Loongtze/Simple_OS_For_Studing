## 0x00 基础知识们
今天我们来继续精进咱们的改进MBR，上次我们所做的事是使用显卡显存来实现屏幕输出，今天我们来了解了解磁盘相关知识.
### 1. 硬盘
首先我们来大概给出磁盘的基础知识，可能大伙学过机组或者说操作系统这两门课程的同学对此会比较熟悉，但我在这里还是简单说几句，首先就是磁盘的结构（注意下面解释的是机械键盘，而不是咱们目前比较常见的固态硬盘）。下面先给出图片：
一个磁盘由多个盘面组成，可以理解成下面途中光盘的A面B面
![](https://img-blog.csdnimg.cn/20191123182101621.png)
每个盘片被划分为一个个磁道，而这每个磁道也被称为柱面，你可以运用立体思维来想想，这么多个盘组合在一起那不就成了一个圆柱体了吗，然后圆柱体中我任取一个磁道，他们所有盘面的相对磁道恰好就构成了一个圆柱面，每个磁道又划分为一个个扇区。如下图：
![](https://img-blog.csdnimg.cn/20191123183720314.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zNzY0MTgzMg==,size_16,color_FFFFFF,t_70)
由上，可用（柱面号，盘面号，扇区号）来定位任意一个“磁盘块”。这也被成为物理磁盘地址（由于磁盘属于块设备，所以一个地址对应了一个块，或者说一个簇）
可根据该地址读取一个“块”，操作如下：
1. 根据“柱面号”移动磁臂，让磁头指向指定柱面；

2. 激活指定盘面对应的磁头；

3. 磁盘旋转的过程中，指定的扇区会从磁头下面划过，这样就完成了对指定扇区的读/写。

---
而硬盘也如同外设，其中也必定要有IO接口来实现与CPU通信，就像对于显卡之于显示器，磁盘也有属于自己的IO接口，那就是硬盘控制器。

### 2. 硬盘控制端口
对于硬盘控制器而言，其IO模式与显卡不同，在使用显卡时，我们是使用了统一编址，但是在硬盘控制器下，其使用的是独立编制，这里有不懂的地方可以参考上一节。以下我给出硬盘控制器主要端口寄存器信息：
![](http://imgsrc.baidu.com/super/pic/item/79f0f736afc379311dd12eedaec4b74542a911bc.jpg)
由上表可知端口分为两组，即为Commend Block registers和Control Block registers，其中Commend Block registers用来向硬盘驱动器写入命令字或从硬盘控制器中读出硬盘状态（因为硬盘会通过发送自己的状态到硬盘控制器，这种状态有且不限于正在忙，空闲等），而Control Block registers用来控制硬盘工作状态，这有点类似于咱们机组中学到的控制/状态寄存器，在应试教育中他俩是和到一起的，而事实上他俩之中Control Block registers也确实精简了许多，他们俩的功能越来越揉和，所以一下主要介绍Commend Block registers

