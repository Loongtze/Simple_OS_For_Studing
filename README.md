## 0x00 基础知识们
今天我们来介绍关于中断的基础知识，理论上经常将中断分为两大类。
### 1.外部中断
一般指CPU外部硬件传来的中断，由于中断源必定为硬件，所以也被称为硬件中断，而我们CPU为了知道外面有人说哎呀我不行了我要中断辣，所以必须得有个传话筒，这里就存在着两个“传话筒”，也就是两根信号线，他们分别是INTR(INTeRrupt)和NMI(Non Maskable Interrupt)
![](http://imgsrc.baidu.com/super/pic/item/2e2eb9389b504fc224d7cac0a0dde71191ef6d6f.jpg)
上图给出了两种信号线的区别，其中INTR收到的信号都是不影响系统运行的，可以随时处理，而NMI收到的信号是必须要立刻处理，NMI收到信号后，一切其他的工作都失去了意义，先把这个中断处理了才是重中之重。
首先我们介绍可屏蔽中断，可屏蔽中断是指的由INTR线传递的中断信号，外部设备如硬盘、网卡等发出的中断都是可屏蔽中断。可屏蔽的意思是此外部设备发出的中断， CPU 可以不理会，因为它不会让系统右机，所以可以通过 eflags寄存器的 IF 位将所有这些外部设备的中断屏蔽。另外，这些设备都是接在某个中断代理设备的，通过该中断代理也可以单独屏蔽某个设备的中断，这是后话，后面会有详细介绍。
然后我们介绍不可屏蔽中断，他是由NMI线传递的中断信号，只要这里传递了中断，计算机就说明遭到了严重的问题，必须立刻处理。此时上述eflags寄存器的IF位对他也毫无影响。

CPU 收到中断后，得知道发生了什么事情才能执行相应的处理办法。这是通过中断向量表或中断描述符表（中断向量表是实模式下的中断处理程序数组，在保护模式下已经被中断描述符表代替，在后面章节中会细说〉来实现的，首先为每一种中断分配一个中断向量号，中断向量号就是一个整数，它就是中断向量表或中断描述符表中的索引下标，用来索引中断项。中断发起时，相应的中断向量号通过 NMI INTR引脚被传入 CPU ，中断向量号是中断向量表或中断描述符表里中断项的下标， CPU 根据此中断向量号在中断向量表或中断描述符表中检索对应的中断处理程序井去执行。

### 2.内部中断
介绍玩外部中断，这里我们来介绍内部的，内部中断又可以继续划分，分为软中断和异常
软中断，就是由软件主动发起的中断，因为它来自于软件，所以称之为软中断。由于该中断是软件运行中主动发起的，所以它是主观上的，井不是客观上的某种内部错误。
下面就是咱们可以发起中断的指令：
+ int (8位数据)：8位可表示256种中断，这条指令在之后我们会经常使用
+ int3 ：调试断点指令，它所出发的中断向量号是3,当我们使用gdb或bochs进行调试时，实际上就是调试器fork了一个子进程。调试器中设置断点实际上就是父进程修改子进程，将其用int3指令替换，从而实现中断使得咱们可以停在断点，
+ into ：这是中断溢出指令，它所触发的中断向量号是4。不过，能否引发4号中断是要看 eflags志寄存器中的 OF 位是否为1，如果是1才会引发中断，否则该指令悄悄地什么都不做，低调得很
+ bound ：这是检查数组索引越界指令，它可以触发5号中断，用于检查数组的索引下标是否在上下边界之内。该指令格式是“bound 16/32 位寄存器， 16/32 位内存飞目的操作数是用寄存器来存储的，其内容是待检测的数组下标值。源操作数是内存，其内容是数组下标的下边界和上边界 当执行 bound 指令时，若下标处于数组索引的范围之外，则会触发5号中断。
+ ud2 ：触发6号中断，无实际用途

而异常是我们程序运行时出现的错误，他同样不受eflags寄存器中的标志位的影响，也就是说不可屏蔽，因为都出现错误了计算机说想看不见也不行，异常可以分为以下3种：
1. Fault，故障，可修复，例如缺页异常
2. Trap，陷阱，自己想陷入中断，所以中断返回后执行下一条指令。
3. Abort, 终止，无法修复，操作系统为求自保，只能把该程序从进程表移除

这里给出我们异常与中断的汇总表供大家参考：
![](http://imgsrc.baidu.com/super/pic/item/a044ad345982b2b70acc5c0174adcbef77099ba0.jpg)

其中我们的中断向量号的作用类似于选择子，都是某个表的下标。

### 3.中断描述符表
得，又来一个表，中断描述符表（Interrupt Descriptor Table，IDT）是保护模式下存放中断处理程序入口的一个表，这里注意同实模式下的中断表区分开来。
而中断描述符表中不止有中断描述符，还有任务门描述符和陷阱门描述符。而由于所有的描述符都指向了一段程序，这里就体现出来他与GDT的不同，所以在这里的描述符有个另外的名字，那就是“门”。
所有的门都是8字节，这里我们来回忆一下描述符中的字段类型，type字段指明了该描述符的类型，其中的S位若为1则说明该段为数据段，为0则表示为系统段，咱们这里的门就属于系统段

